Index: gdm-2.30.0/daemon/gdm-xdmcp-display-factory.c
===================================================================
--- gdm-2.30.0.orig/daemon/gdm-xdmcp-display-factory.c	2010-04-26 22:52:52.315121124 +0200
+++ gdm-2.30.0/daemon/gdm-xdmcp-display-factory.c	2010-04-26 22:53:03.779622721 +0200
@@ -411,6 +411,14 @@ create_socket (struct addrinfo *ai)
                 return sock;
         }
 
+#if defined(ENABLE_IPV6) && defined(IPV6_V6ONLY)
+       if (ai->ai_family == AF_INET6) {
+               int zero = 0;
+               if (setsockopt(sock, IPPROTO_IPV6, IPV6_V6ONLY, &zero, sizeof(zero)) < 0)
+                       g_warning("setsockopt(IPV6_V6ONLY): %s", g_strerror(errno));
+       }
+#endif
+
         if (bind (sock, ai->ai_addr, ai->ai_addrlen) < 0) {
                 g_warning ("bind: %s", g_strerror (errno));
                 close (sock);
Index: gdm-2.30.0/gui/simple-chooser/gdm-host-chooser-widget.c
===================================================================
--- gdm-2.30.0.orig/gui/simple-chooser/gdm-host-chooser-widget.c	2010-04-26 22:53:15.999120959 +0200
+++ gdm-2.30.0/gui/simple-chooser/gdm-host-chooser-widget.c	2010-04-26 22:53:25.103171390 +0200
@@ -544,6 +544,13 @@ xdmcp_init (GdmHostChooserWidget *widget
         widget->priv->socket_fd = socket (AF_INET6, SOCK_DGRAM, 0);
         if (widget->priv->socket_fd != -1) {
                 widget->priv->have_ipv6 = TRUE;
+#ifdef IPV6_V6ONLY
+               {
+                       int zero = 0;
+                       if (setsockopt(widget->priv->socket_fd, IPPROTO_IPV6, IPV6_V6ONLY, &zero, sizeof(zero)) < 0)
+                               g_warning("setsockopt(IPV6_V6ONLY): %s", g_strerror(errno));
+               }
+#endif
         }
 #endif
         if (! widget->priv->have_ipv6) {
